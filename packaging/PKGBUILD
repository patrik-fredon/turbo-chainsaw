# Maintainer: Fredon Menu Team <contact@fredon-menu.org>

pkgname=fredon-menu
pkgver=1.0.0
pkgrel=1
pkgdesc="A modern, customizable application launcher for Hyprland/Wayland"
arch=('x86_64')
url="https://github.com/your-username/fredon-menu"
license=('MIT')
depends=(
    'python>=3.11'
    'python-gobject>=3.42.0'
    'gtk3>=3.24.0'
    'gtk-layer-shell>=0.8.0'
    'gdk-pixbuf2>=2.42.0'
    'python-pillow>=9.0.0'
    'python-watchdog>=2.1.0'
)
makedepends=(
    'python-build'
    'python-installer'
    'python-setuptools'
    'python-wheel'
)
optdepends=(
    'libnotify: Desktop notifications'
    'xdg-utils: Default application launching'
)
source=(
    "$pkgname-$pkgver.tar.gz::https://github.com/your-username/$pkgname/archive/v$pkgver.tar.gz"
)
sha256sums=(
    'SKIP'  # Replace with actual checksum when releasing
)

build() {
    cd "$pkgname-$pkgver"

    # Build the package
    python -m build --wheel --no-isolation
}

package() {
    cd "$pkgname-$pkgver"

    # Install the package
    python -m installer --destdir="$pkgdir" dist/*.whl

    # Install desktop entry
    install -Dm644 packaging/fredon-menu.desktop \
        "$pkgdir/usr/share/applications/fredon-menu.desktop"

    # Install systemd user service
    install -Dm644 packaging/fredon-menu.service \
        "$pkgdir/usr/lib/systemd/user/fredon-menu.service"

    # Install default configuration
    install -Dm644 src/data/default.json \
        "$pkgdir/usr/share/fredon-menu/default.json"

    # Install documentation
    install -Dm644 README.md "$pkgdir/usr/share/doc/$pkgname/README.md"
    install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"

    # Create directories
    install -dm755 "$pkgdir/usr/share/icons/hicolor/256x256/apps"

    # Create a simple default icon if not available
    if [ ! -f "src/data/icons/fredon-menu.png" ]; then
        # Generate a simple icon (placeholder)
        convert -size 256x256 xc:transparent \
            -fill "#2a2a2a" -draw "rectangle 32,32 224,224" \
            -fill "#ffffff" -pointsize 24 -gravity center \
            -annotate +0+0 "FM" \
            "$pkgdir/usr/share/icons/hicolor/256x256/apps/fredon-menu.png" 2>/dev/null || true
    else
        install -m644 src/data/icons/fredon-menu.png \
            "$pkgdir/usr/share/icons/hicolor/256x256/apps/fredon-menu.png"
    fi

    # Install shell completion (if available)
    if [ -f "completions/fredon-menu.bash" ]; then
        install -Dm644 completions/fredon-menu.bash \
            "$pkgdir/usr/share/bash-completion/completions/fredon-menu"
    fi

    if [ -f "completions/fredon-menu.zsh" ]; then
        install -Dm644 completions/fredon-menu.zsh \
            "$pkgdir/usr/share/zsh/site-functions/_fredon-menu"
    fi

    if [ -f "completions/fredon-menu.fish" ]; then
        install -Dm644 completions/fredon-menu.fish \
            "$pkgdir/usr/share/fish/vendor_completions.d/fredon-menu.fish"
    fi
}